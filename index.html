<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="pageTitle">Braid Cost Estimator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles can be added here if needed */
        body { font-family: 'Inter', sans-serif; transition: background-color 0.3s, color 0.3s; }
        .hidden { display: none; }

        /* Minimalist dropdown styling */
        .control-select {
            padding: 0.4rem 0.8rem; /* Reduced padding */
            border-radius: 0.375rem; /* Rounded corners */
            border: 1px solid #d1d5db; /* Gray 300 */
            background-color: #fff; /* White */
            color: #1f2937; /* Gray 800 */
            font-size: 0.875rem; /* Smaller font */
            cursor: pointer;
            transition: border-color 0.2s, box-shadow 0.2s;
            -webkit-appearance: none; /* Remove default arrow on some browsers */
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2220%22%20height%3D%2220%22%20fill%3D%22%236b7280%22%3E%3Cpath%20fill-rule%3D%22evenodd%22%20d%3D%22M5.293%207.293a1%201%200%20011.414%200L10%2010.586l3.293-3.293a1%201%200%20111.414%201.414l-4%204a1%201%200%2001-1.414%200l-4-4a1%201%200%20010-1.414z%22%20clip-rule%3D%22evenodd%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.25em;
            padding-right: 2.5rem; /* Make space for arrow */
        }

        .control-select:focus {
            outline: none;
            border-color: #4f46e5; /* Indigo 600 */
            box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.3); /* Indigo focus ring */
        }

        html.dark .control-select {
            border-color: #4b5563; /* Gray 600 */
            background-color: #374151; /* Gray 700 */
            color: #e5e7eb; /* Gray 200 */
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2220%22%20height%3D%2220%22%20fill%3D%22%23d1d5db%22%3E%3Cpath%20fill-rule%3D%22evenodd%22%20d%3D%22M5.293%207.293a1%201%200%20011.414%200L10%2010.586l3.293-3.293a1%201%200%20111.414%201.414l-4%204a1%201%200%2001-1.414%200l-4-4a1%201%200%20010-1.414z%22%20clip-rule%3D%22evenodd%22%2F%3E%3C%2Fsvg%3E');
        }
         html.dark .control-select:focus {
            border-color: #6366f1; /* Indigo 500 */
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.4); /* Indigo focus ring dark */
         }

    </style>
     <script>
        // Set theme ASAP to avoid FOUC (Flash of Unstyled Content)
        function applyThemeSetting() {
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
                return 'dark';
            } else {
                document.documentElement.classList.remove('dark');
                return 'light';
            }
        }
        applyThemeSetting();
    </script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-2xl">

        <header class="mb-6 p-4 bg-white dark:bg-gray-800 rounded-lg shadow-sm flex justify-end items-center gap-4">
            <div class="flex items-center gap-3">
                 <div>
                    <label for="themeSelect" class="sr-only" data-translate="themeLabel">Theme:</label>
                    <select id="themeSelect" class="control-select">
                        </select>
                </div>
                <div>
                    <label for="languageSelect" class="sr-only" data-translate="languageLabel">Language:</label>
                    <select id="languageSelect" class="control-select">
                        </select>
                </div>
            </div>
        </header>

        <h1 id="mainTitle" class="text-2xl sm:text-3xl font-bold text-gray-800 dark:text-white text-center mb-6" data-translate="mainTitle">Braid Service Cost Estimator</h1>

        <div class="space-y-6 bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
            <div class="form-group">
                <label for="braidStyle" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" data-translate="braidStyleLabel">Braid Style:</label>
                <select id="braidStyle" class="mt-1 block w-full p-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-base text-gray-900 dark:text-white">
                    </select>
            </div>

            <div class="form-group">
                <label for="headCoverage" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" data-translate="headCoverageLabel">Head Coverage:</label>
                <select id="headCoverage" class="mt-1 block w-full p-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-base text-gray-900 dark:text-white">
                    </select>
            </div>

            <div id="cornrowsOptionsContainer" class="form-group hidden">
                <label for="cornrowRows" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" data-translate="cornrowRowsLabel">Number of Cornrows:</label>
                <input type="number" id="cornrowRows" value="4" min="1" class="mt-1 block w-full p-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-base text-gray-900 dark:text-white">
            </div>

            <div id="divisionOptionsContainer" class="form-group hidden">
                <label for="divisionSize" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" data-translate="divisionSizeLabel">Division Size:</label>
                <select id="divisionSize" class="mt-1 block w-full p-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-base text-gray-900 dark:text-white">
                    </select>
            </div>

            <div id="mixBraidsOptionsContainer" class="form-group hidden space-y-3">
                <div>
                    <label for="mixPercentage" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" data-translate="mixPercentageLabel">Percentage of Cornrows:</label>
                    <div class="flex items-center mt-1">
                        <input type="range" id="mixPercentage" value="50" min="0" max="100" step="10" class="w-full h-2 bg-gray-200 dark:bg-gray-600 rounded-lg appearance-none cursor-pointer accent-indigo-600">
                        <span id="mixPercentageValue" class="ml-3 text-sm text-gray-600 dark:text-gray-400 w-12 text-right">50%</span>
                    </div>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1" data-translate="mixPercentageHint">The rest is Box Braids.</p>
                </div>
            </div>

            <div class="form-group space-y-3">
                <div class="flex items-center">
                    <input type="checkbox" id="needsExtensions" class="h-5 w-5 text-indigo-600 border-gray-300 dark:border-gray-600 rounded focus:ring-indigo-500 bg-gray-100 dark:bg-gray-700">
                    <label for="needsExtensions" class="ml-2 block text-sm font-medium text-gray-700 dark:text-gray-300" data-translate="extensionsLabel">Add Extensions?</label>
                </div>
                <div id="extensionAmountContainer" class="hidden">
                    <label for="extensionAmount" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" data-translate="extensionAmountLabel">Amount:</label>
                    <select id="extensionAmount" class="mt-1 block w-full p-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-base text-gray-900 dark:text-white">
                        </select>
                </div>
            </div>
        </div>

        <div class="mt-8 p-6 border-2 border-indigo-600 dark:border-indigo-500 rounded-lg bg-indigo-50 dark:bg-gray-800 shadow-lg">
            <h2 class="text-xl sm:text-2xl font-semibold text-indigo-800 dark:text-indigo-200">
                <span data-translate="estimatedPriceLabel">Estimated Price:</span>
                <span id="estimatedPrice" class="text-indigo-700 dark:text-indigo-300">€0.00</span>
            </h2>
            <p class="text-sm text-gray-700 dark:text-gray-300 mt-1">
                <span data-translate="estimatedTimeLabel">Estimated Time:</span>
                <span id="estimatedTime" class="font-medium">0</span>
                <span data-translate="hoursUnit"> hours</span>
            </p>
            <div id="priceBreakdown" class="text-xs text-gray-500 dark:text-gray-400 mt-2 space-y-0.5">
                </div>
        </div>
    </div>

    <script>
        // --- TRANSLATIONS ---
        const translations = {
            en: {
                pageTitle: "Braid Cost Estimator",
                mainTitle: "Braid Service Cost Estimator",
                themeLabel: "Theme", themeLight: "Light", themeDark: "Dark", themeSystem: "System", // Theme label for sr-only
                languageLabel: "Language", langEN: "English", langES: "Español", // Language label for sr-only
                braidStyleLabel: "Braid Style:",
                headCoverageLabel: "Head Coverage:",
                cornrowRowsLabel: "Number of Cornrows:",
                divisionSizeLabel: "Division Size:",
                mixPercentageLabel: "Percentage of Cornrows:",
                mixPercentageHint: "The rest is Box Braids.",
                extensionsLabel: "Add Extensions?",
                extensionAmountLabel: "Amount:",
                estimatedPriceLabel: "Estimated Price:",
                estimatedTimeLabel: "Estimated Time:",
                hoursUnit: " hours",
                selectOption: "Select an option",
                // Styles
                style_cornrows: "Cornrows",
                style_boxBraids: "Box Braids",
                style_bohemianBraids: "Bohemian Braids",
                style_mixBraids: "Mix Braids",
                // Head Coverage
                hc_full: "Full Head",
                hc_topOnly: "Top Only (approx 40%)",
                hc_topAndBack: "Top and Back (approx 70%)",
                hc_mohawk: "Mohawk Area (approx 30%)",
                hc_topBackOneSide: "Top, Back, and One Side (approx 85%)",
                // Division Sizes
                div_small: "Small (<1.5cm side)",
                div_medium: "Medium (1.5-2.5cm side)",
                div_large: "Large (>2.5cm side)",
                // Extensions
                ext_little: "Little",
                ext_normal: "Normal",
                ext_aLot: "A Lot",
                // Breakdown
                bd_cornrowsLabor: "Cornrows Labor",
                bd_rows: "rows",
                bd_boxBraidsLabor: "Box Braids Labor",
                bd_bohemianLabor: "Bohemian Braids Labor",
                bd_division: "Division",
                bd_bohemianCurls: "Bohemian Curls Add-on",
                bd_material: "Material",
                bd_labor: "Labor",
                bd_mixCornrows: "Mix - Cornrows Part",
                bd_mixBoxBraids: "Mix - Box Braids Part",
                bd_headCoverage: "Head Coverage Adjustment",
                bd_styleLaborFull: "Style Labor (Full Head)",
                bd_extensions: "Extensions",
                bd_added: "added",
                bd_fixedCosts: "Fixed Costs (Product & Polishing)",
                bd_selectStyle: "Please select a braid style.",
            },
            es: {
                pageTitle: "Estimador de Costo de Trenzas",
                mainTitle: "Estimador de Costo de Servicio de Trenzas",
                themeLabel: "Tema", themeLight: "Claro", themeDark: "Oscuro", themeSystem: "Sistema",
                languageLabel: "Idioma", langEN: "Inglés", langES: "Spanish",
                braidStyleLabel: "Estilo de Trenza:",
                headCoverageLabel: "Cobertura de Cabeza:",
                cornrowRowsLabel: "Número de Trenzas Pegadas:",
                divisionSizeLabel: "Tamaño de División:",
                mixPercentageLabel: "Porcentaje de Trenzas Pegadas:",
                mixPercentageHint: "El resto son Trenzas Sueltas.",
                extensionsLabel: "¿Añadir Extensiones?",
                extensionAmountLabel: "Cantidad:",
                estimatedPriceLabel: "Precio Estimado:",
                estimatedTimeLabel: "Tiempo Estimado:",
                hoursUnit: " horas",
                selectOption: "Seleccione una opción",
                // Styles
                style_cornrows: "Trenzas Pegadas",
                style_boxBraids: "Trenzas Sueltas (Box Braids)",
                style_bohemianBraids: "Trenzas Bohemias",
                style_mixBraids: "Trenzas Mixtas",
                // Head Coverage
                hc_full: "Cabeza Completa",
                hc_topOnly: "Solo Arriba (aprox 40%)",
                hc_topAndBack: "Arriba y Detrás (aprox 70%)",
                hc_mohawk: "Zona Mohawk (aprox 30%)",
                hc_topBackOneSide: "Arriba, Detrás y Un Lado (aprox 85%)",
                // Division Sizes
                div_small: "Pequeño (<1.5cm lado)",
                div_medium: "Mediano (1.5-2.5cm lado)",
                div_large: "Grande (>2.5cm lado)",
                // Extensions
                ext_little: "Pocas",
                ext_normal: "Normal",
                ext_aLot: "Muchas",
                // Breakdown
                bd_cornrowsLabor: "Mano de Obra Trenzas Pegadas",
                bd_rows: "filas",
                bd_boxBraidsLabor: "Mano de Obra Trenzas Sueltas",
                bd_bohemianLabor: "Mano de Obra Trenzas Bohemias",
                bd_division: "División",
                bd_bohemianCurls: "Añadido Rizos Bohemios",
                bd_material: "Material",
                bd_labor: "Mano de Obra",
                bd_mixCornrows: "Mixtas - Parte Pegadas",
                bd_mixBoxBraids: "Mixtas - Parte Sueltas",
                bd_headCoverage: "Ajuste Cobertura Cabeza",
                bd_styleLaborFull: "Mano de Obra Estilo (Completa)",
                bd_extensions: "Extensiones",
                bd_added: "añadido",
                bd_fixedCosts: "Costos Fijos (Producto y Acabado)",
                bd_selectStyle: "Por favor, seleccione un estilo de trenza.",
            }
        };
        let currentLang = 'en';

        // --- DOM ELEMENTS ---
        const themeSelect = document.getElementById('themeSelect');
        const languageSelect = document.getElementById('languageSelect');
        // (Other DOM elements remain the same)
        const braidStyleSelect = document.getElementById('braidStyle');
        const headCoverageSelect = document.getElementById('headCoverage');
        const cornrowsOptionsContainer = document.getElementById('cornrowsOptionsContainer');
        const cornrowRowsInput = document.getElementById('cornrowRows');
        const divisionOptionsContainer = document.getElementById('divisionOptionsContainer');
        const divisionSizeSelect = document.getElementById('divisionSize');
        const mixBraidsOptionsContainer = document.getElementById('mixBraidsOptionsContainer');
        const mixPercentageInput = document.getElementById('mixPercentage');
        const mixPercentageValueSpan = document.getElementById('mixPercentageValue');
        const needsExtensionsCheckbox = document.getElementById('needsExtensions');
        const extensionAmountContainer = document.getElementById('extensionAmountContainer');
        const extensionAmountSelect = document.getElementById('extensionAmount');
        const estimatedPriceSpan = document.getElementById('estimatedPrice');
        const estimatedTimeSpan = document.getElementById('estimatedTime');
        const priceBreakdownDiv = document.getElementById('priceBreakdown');


        function translate(key) {
            return translations[currentLang][key] || key;
        }

        function updateAllText() {
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                const translation = translate(key);
                if (el.tagName === 'TITLE') { // Handle title tag specifically
                    el.innerText = translation;
                } else if (el.tagName === 'LABEL' && el.classList.contains('sr-only')) { // For sr-only labels
                    // Don't set textContent for sr-only, but ensure it's translated if needed elsewhere
                }
                else {
                    el.textContent = translation;
                }
            });
            // Update select options
            populateSelectWithOptions(braidStyleSelect, braidStylesData);
            populateSelectWithOptions(headCoverageSelect, headCoverageOptions);
            populateSelectWithOptions(divisionSizeSelect, braidStylesData.boxBraids.divisionOptions);
            populateSelectWithOptions(extensionAmountSelect, extensionOptions);
            // Populate theme and language dropdowns
            populateThemeDropdown();
            populateLanguageDropdown();
            calculatePrice(); // Recalculate to update breakdown text
        }

        function setLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;
            localStorage.setItem('language', lang);
            updateAllText(); // This will re-populate dropdowns with new lang
            languageSelect.value = lang; // Ensure dropdown reflects current language
        }

        function detectLanguage() {
            const storedLang = localStorage.getItem('language');
            if (storedLang && translations[storedLang]) {
                return storedLang;
            }
            const browserLang = navigator.language.split('-')[0];
            return translations[browserLang] ? browserLang : 'en'; // Default to 'en'
        }

        function populateLanguageDropdown() {
            const currentVal = languageSelect.value;
            languageSelect.innerHTML = '';
            const langOptions = [
                { value: 'en', textKey: 'langEN' },
                { value: 'es', textKey: 'langES' }
            ];
            langOptions.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt.value;
                option.textContent = translate(opt.textKey);
                languageSelect.appendChild(option);
            });
            languageSelect.value = currentVal || currentLang;
        }


        // --- THEME ---
        function applyTheme(theme) {
            const html = document.documentElement;
            if (theme === 'dark') {
                html.classList.add('dark');
                localStorage.theme = 'dark';
            } else if (theme === 'light') {
                html.classList.remove('dark');
                localStorage.theme = 'light';
            } else { // System
                localStorage.removeItem('theme');
                if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    html.classList.add('dark');
                } else {
                    html.classList.remove('dark');
                }
            }
            if (themeSelect) themeSelect.value = theme; // Update dropdown
        }

        function populateThemeDropdown() {
            const currentVal = themeSelect.value;
            themeSelect.innerHTML = '';
            const themeOptions = [
                { value: 'light', textKey: 'themeLight' },
                { value: 'dark', textKey: 'themeDark' },
                { value: 'system', textKey: 'themeSystem' }
            ];
            themeOptions.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt.value;
                option.textContent = translate(opt.textKey);
                themeSelect.appendChild(option);
            });
            themeSelect.value = currentVal || getInitialTheme();
        }

         function getInitialTheme() {
            return localStorage.getItem('theme') || 'system';
        }


        // --- DATA DEFINITIONS (with keys for i18n) ---
         const braidStylesData = {
            cornrows: { nameKey: "style_cornrows", hasRows: true, hasDivisions: false, baseLaborPrice: 12.75, laborPricePerRow: 5, baseTime: 1.5, timePerRow: 0.25 },
            boxBraids: {
                nameKey: "style_boxBraids", hasRows: false, hasDivisions: true, baseLaborPriceMediumFull: 70, baseTimeMediumFull: 5,
                divisionOptions: {
                    small: { nameKey: "div_small", priceFactor: 1.6, timeFactor: 1.6 },
                    medium: { nameKey: "div_medium", priceFactor: 1.0, timeFactor: 1.0 },
                    large: { nameKey: "div_large", priceFactor: 0.75, timeFactor: 0.75 },
                },
            },
            bohemianBraids: {
                nameKey: "style_bohemianBraids", hasRows: false, hasDivisions: true, baseLaborPriceMediumFull: 80, baseTimeMediumFull: 5.5,
                divisionOptions: { // Same keys as box braids
                    small: { nameKey: "div_small", priceFactor: 1.6, timeFactor: 1.6 },
                    medium: { nameKey: "div_medium", priceFactor: 1.0, timeFactor: 1.0 },
                    large: { nameKey: "div_large", priceFactor: 0.75, timeFactor: 0.75 },
                },
                curlyHairMaterialCost: 15, curlyHairTimeAdded: 0.75,
            },
            mixBraids: { nameKey: "style_mixBraids", hasRows: true, hasDivisions: true }
        };
        const headCoverageOptions = {
            full: { nameKey: "hc_full", multiplier: 1.0 },
            topOnly: { nameKey: "hc_topOnly", multiplier: 0.4 },
            topAndBack: { nameKey: "hc_topAndBack", multiplier: 0.7 },
            mohawk: { nameKey: "hc_mohawk", multiplier: 0.3 },
            topBackOneSide: { nameKey: "hc_topBackOneSide", multiplier: 0.85 },
        };
        const extensionOptions = {
            little: { nameKey: "ext_little", cost: 10, timeAdded: 0.75 },
            normal: { nameKey: "ext_normal", cost: 20, timeAdded: 1.25 },
            aLot: { nameKey: "ext_aLot", cost: 30, timeAdded: 1.75 },
        };
        const HOURLY_RATE_FOR_EXTENSIONS_LABOR = 15;
        const fixedCosts = { product: 5.25, polishing: 2 };


        // --- INITIALIZATION ---
        function populateSelectWithOptions(selectElement, optionsObject) {
            const currentVal = selectElement.value; // Preserve selection
            selectElement.innerHTML = '';
            for (const key in optionsObject) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = translate(optionsObject[key].nameKey); // Use translate
                selectElement.appendChild(option);
            }
            if (selectElement.querySelector(`option[value="${currentVal}"]`)) {
                 selectElement.value = currentVal; // Restore selection if still valid
            } else if (selectElement.options.length > 0) {
                // If previous value is no longer valid (e.g. after lang change if keys mismatch), select first
                // This part might need more robust handling if keys could truly mismatch
                // selectElement.value = selectElement.options[0].value;
            }
        }

        function initializeForm() {
            // Setup i18n
            currentLang = detectLanguage();
            document.documentElement.lang = currentLang;
            // Populate language dropdown first, then set its value
            populateLanguageDropdown();
            languageSelect.value = currentLang;


            // Setup Theme
            const initialTheme = getInitialTheme();
            // Populate theme dropdown first, then apply theme and set its value
            populateThemeDropdown();
            applyTheme(initialTheme); // Apply theme and it will update themeSelect.value

            // Populate initial options (will be translated)
            populateSelectWithOptions(braidStyleSelect, braidStylesData);
            populateSelectWithOptions(headCoverageSelect, headCoverageOptions);
            populateSelectWithOptions(divisionSizeSelect, braidStylesData.boxBraids.divisionOptions);
            populateSelectWithOptions(extensionAmountSelect, extensionOptions);
             if (extensionAmountSelect.options.namedItem('normal')) { // This might not work if 'normal' is translated
                 // A safer way: find by key if possible or set a default key
                 extensionAmountSelect.value = 'normal';
            }


            // Apply all translations to static elements
            updateAllText(); // This will re-translate everything including dropdown options

            // Set up event listeners
            setupEventListeners();
            
            // Initial UI state and calculation
            updateOptionsVisibility();
            calculatePrice();
        }

         function setupEventListeners() {
            // Theme select
            themeSelect.addEventListener('change', (e) => applyTheme(e.target.value));
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
                 if(localStorage.getItem('theme') === 'system' || !localStorage.getItem('theme')) {
                     applyTheme('system'); // This will also update the dropdown
                 }
            });

            // Language select
            languageSelect.addEventListener('change', (e) => setLanguage(e.target.value));


            // Form elements
            braidStyleSelect.addEventListener('change', () => { updateOptionsVisibility(); calculatePrice(); });
            headCoverageSelect.addEventListener('change', calculatePrice);
            cornrowRowsInput.addEventListener('input', calculatePrice);
            divisionSizeSelect.addEventListener('change', calculatePrice);
            mixPercentageInput.addEventListener('input', () => {
                mixPercentageValueSpan.textContent = `${mixPercentageInput.value}%`;
                calculatePrice();
            });
            needsExtensionsCheckbox.addEventListener('change', () => { updateOptionsVisibility(); calculatePrice(); });
            extensionAmountSelect.addEventListener('change', calculatePrice);
        }

        // --- UI LOGIC (updateOptionsVisibility - mostly unchanged) ---
        function updateOptionsVisibility() {
            const selectedStyleKey = braidStyleSelect.value;
            if (!selectedStyleKey) return; // Handle no selection
            const style = braidStylesData[selectedStyleKey];

            cornrowsOptionsContainer.classList.toggle('hidden', !style || (!style.hasRows && selectedStyleKey !== 'mixBraids'));
            divisionOptionsContainer.classList.toggle('hidden', !style || (!style.hasDivisions && selectedStyleKey !== 'mixBraids'));
            mixBraidsOptionsContainer.classList.toggle('hidden', selectedStyleKey !== 'mixBraids');

            if (selectedStyleKey === 'mixBraids') {
                cornrowsOptionsContainer.classList.remove('hidden');
                divisionOptionsContainer.classList.remove('hidden');
            }
            extensionAmountContainer.classList.toggle('hidden', !needsExtensionsCheckbox.checked);
        }

        // --- CALCULATION LOGIC (Updated to use translate) ---
        function calculatePrice() {
            if (!braidStyleSelect.value) {
                estimatedPriceSpan.textContent = "€0.00";
                estimatedTimeSpan.textContent = "0";
                priceBreakdownDiv.innerHTML = `<p>${translate('bd_selectStyle')}</p>`;
                return;
            }

            const selectedStyleKey = braidStyleSelect.value;
            const styleData = braidStylesData[selectedStyleKey];
            const headCoverage = headCoverageOptions[headCoverageSelect.value];

            let baseLabor = 0;
            let baseTime = 0;
            let materialCosts = 0;
            let breakdownHtml = "";

            if (selectedStyleKey === 'cornrows') {
                const rows = parseInt(cornrowRowsInput.value) || 0;
                baseLabor = styleData.baseLaborPrice + (rows * styleData.laborPricePerRow);
                baseTime = styleData.baseTime + (rows * styleData.timePerRow);
                breakdownHtml += `<p>${translate('bd_cornrowsLabor')} (${rows} ${translate('bd_rows')}): €${baseLabor.toFixed(2)} (${baseTime.toFixed(1)}h)</p>`;
            } else if (selectedStyleKey === 'boxBraids' || selectedStyleKey === 'bohemianBraids') {
                const division = styleData.divisionOptions[divisionSizeSelect.value];
                baseLabor = styleData.baseLaborPriceMediumFull * division.priceFactor;
                baseTime = styleData.baseTimeMediumFull * division.timeFactor;
                breakdownHtml += `<p>${translate(styleData.nameKey)} (${translate('bd_division')}: ${translate(division.nameKey)}): €${baseLabor.toFixed(2)} (${baseTime.toFixed(1)}h)</p>`;
                if (selectedStyleKey === 'bohemianBraids') {
                    materialCosts += styleData.curlyHairMaterialCost;
                    const curlLabor = styleData.curlyHairTimeAdded * HOURLY_RATE_FOR_EXTENSIONS_LABOR;
                    baseTime += styleData.curlyHairTimeAdded;
                    baseLabor += curlLabor;
                    breakdownHtml += `<p>${translate('bd_bohemianCurls')}: €${styleData.curlyHairMaterialCost.toFixed(2)} (${translate('bd_material')}) + €${curlLabor.toFixed(2)} (${translate('bd_labor')}), ${styleData.curlyHairTimeAdded.toFixed(1)}h</p>`;
                }
            } else if (selectedStyleKey === 'mixBraids') {
                 const cornrowPercent = parseInt(mixPercentageInput.value) / 100;
                 const boxBraidPercent = 1 - cornrowPercent;
                 const cornrowsStyleData = braidStylesData.cornrows;
                 const numCornrows = parseInt(cornrowRowsInput.value) || 0;
                 const boxBraidsStyleData = braidStylesData.boxBraids;
                 const division = boxBraidsStyleData.divisionOptions[divisionSizeSelect.value];

                 const cornrowPartLabor = (cornrowsStyleData.baseLaborPrice + (numCornrows * cornrowsStyleData.laborPricePerRow)) * cornrowPercent;
                 const cornrowPartTime = (cornrowsStyleData.baseTime + (numCornrows * cornrowsStyleData.timePerRow)) * cornrowPercent;
                 const boxBraidPartLabor = (boxBraidsStyleData.baseLaborPriceMediumFull * division.priceFactor) * boxBraidPercent;
                 const boxBraidPartTime = (boxBraidsStyleData.baseTimeMediumFull * division.timeFactor) * boxBraidPercent;

                 if (cornrowPercent > 0) {
                    breakdownHtml += `<p>${translate('bd_mixCornrows')} (${(cornrowPercent*100).toFixed(0)}%, ${numCornrows} ${translate('bd_rows')}): €${cornrowPartLabor.toFixed(2)} (${cornrowPartTime.toFixed(1)}h)</p>`;
                 }
                 if (boxBraidPercent > 0) {
                    breakdownHtml += `<p>${translate('bd_mixBoxBraids')} (${(boxBraidPercent*100).toFixed(0)}%, ${translate('bd_division')}: ${translate(division.nameKey)}): €${boxBraidPartLabor.toFixed(2)} (${boxBraidPartTime.toFixed(1)}h)</p>`;
                 }
                 baseLabor = cornrowPartLabor + boxBraidPartLabor;
                 baseTime = cornrowPartTime + boxBraidPartTime;
            }

            let adjustedLabor = baseLabor * headCoverage.multiplier;
            let adjustedTime = baseTime * headCoverage.multiplier;

             if (headCoverage.multiplier !== 1.0) {
                 breakdownHtml += `<p>${translate('bd_headCoverage')} (${translate(headCoverage.nameKey)} - ${headCoverage.multiplier*100}%): ${translate('bd_labor')} €${adjustedLabor.toFixed(2)}, ${adjustedTime.toFixed(1)}h</p>`;
            } else {
                 breakdownHtml += `<p>${translate('bd_styleLaborFull')}: €${adjustedLabor.toFixed(2)}, ${adjustedTime.toFixed(1)}h</p>`;
            }


            let extensionCost = 0;
            let extensionLabor = 0;
            let extensionTimeAdded = 0;
            if (needsExtensionsCheckbox.checked) {
                const selectedExtension = extensionOptions[extensionAmountSelect.value];
                if (selectedExtension) {
                    extensionCost = selectedExtension.cost;
                    extensionTimeAdded = selectedExtension.timeAdded;
                    extensionLabor = extensionTimeAdded * HOURLY_RATE_FOR_EXTENSIONS_LABOR;
                    materialCosts += extensionCost;
                    adjustedTime += extensionTimeAdded;
                    adjustedLabor += extensionLabor;
                    breakdownHtml += `<p>${translate('bd_extensions')} (${translate(selectedExtension.nameKey)}): €${extensionCost.toFixed(2)} (${translate('bd_material')}) + €${extensionLabor.toFixed(2)} (${translate('bd_labor')}), ${extensionTimeAdded.toFixed(1)}h ${translate('bd_added')}</p>`;
                }
            }

            const totalFixedCosts = fixedCosts.product + fixedCosts.polishing;
            materialCosts += totalFixedCosts;
            breakdownHtml += `<p>${translate('bd_fixedCosts')}: €${totalFixedCosts.toFixed(2)}</p>`;

            const finalPrice = adjustedLabor + materialCosts;

            estimatedPriceSpan.textContent = `€${finalPrice.toFixed(2)}`;
            estimatedTimeSpan.textContent = `${adjustedTime.toFixed(1)}`;
            priceBreakdownDiv.innerHTML = breakdownHtml;
        }

        // --- STARTUP ---
        document.addEventListener('DOMContentLoaded', initializeForm);

    </script>

</body>
</html>
